<!DOCTYPE html>
<html lang="en" style="height: 100%;">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body style="height: 98%;">
	<iframe id="myiframe" is="x-frame-bypass" target='_top' style="height: 100%;width: 100%;" src="https://web.whatsapp.com/?iframe_channel=is_anivia" frameborder="0"></iframe>
	<!-- <iframe id="myiframe" is="x-frame-bypass" target='_top' sandbox="allow-same-origin" style="height: 100%;width: 100%;" src="https://web.whatsapp.com/?iframe_channel=is_anivia&output=embed" frameborder="0"></iframe> -->
    <!-- <iframe style="height: 100%;width: 100%;" src="http://www.baidu.com/" frameborder="0"></iframe> -->
</body>

<script>
    $wgEditPageFrameOptions = "SAMEORIGIN"
    // const iFrameDom = document.createElement("iframe");
    // iFrameDom.style = 'height: 100%;width: 100%;';
    // iFrameDom.src = 'https://web.whatsapp.com?iframe_channel=is_anivia';
    // iFrameDom.frameborder = 0;

    // document.getElementsByTagName("body")[0].appendChild(iFrameDom);
    // const iFrameContent = iFrameDom.contentDocument || iFrameDom.contentWindow.document;

    
    // setTimeout(function() {
    //     const iFrameDom = document.getElementById("myiframe").contentWindow;
    //     const iFrameDom1 = document.getElementById("myiframe");
    //     // iFrameContent.postMessage(message, targetOrigin, [transfer]);
    //     // - otherWindow
    //     //      其他窗口的一个引用，比如 iframe 的 contentWindow 属性、执行 window.open 返回的窗口对象、或者是命名过或数值索引的 window.frames。
    //     // - message
    //     //      要发送的数据。它将会被结构化克隆算法序列化，所以无需自己序列化（部分低版本浏览器只支持字符串，所以发送的数据最好用JSON.stringify() 序列化）。
    //     // - targetOrigin
    //     //      通过 targetOrigin 属性来指定哪些窗口能接收到消息事件，其值可以是字符串“*”（表示无限制）或者一个 URI（如果要指定和当前窗口同源的话可设置为"/"）。在发送消息的时候，如果目标窗口的协议、主机地址或端口号这三者的任意一项不匹配 targetOrigin 提供的值，那么消息就不会发送

    //     console.error('iFrameDom', iFrameDom);
    //     console.error('iFrameDom1', iFrameDom1);
    //     // console.error('iFrameDom.postMessage', iFrameDom.postMessage);
    //     // console.error('iFrameContent', iFrameContent);
    //     // 这个是给监听iframe发送通讯消息的
    //     iFrameDom.postMessage({ message: '来自wa的消息' }, 'http://127.0.0.1:5500', ['transfer']);
    //     // iFrameContent.postMessage('message', 'https://web.whatsapp.com', ['transfer']);
    // }, 5000)

    // window.addEventListener('message',(e) => {
    //     console.error('e.datae.datae.datae.data', e.data);
    // }, false)

    const w = window;

    // setTimeout(function(w) {
    // 接收domain1的数据
    w.addEventListener('message',(e) => {
        // console.error('e.data', e.data);
        // if (e.origin !== 'http://127.0.0.1:5500')
        // return;

        // console.error('e', e);
        console.error('e.data', e.data);
        // console.error('w.parent', w.parent);

        // 发送消息给domain1
        // 这个是给iframe发送通讯消息的
        // w.parent.postMessage('来自domain2的消息', e.origin);
    }, false);
    // }, 6000)

</script>
<script>
    // (function() {
    //     var cors_api_host = 'cors-anywhere.herokuapp.com';
    //     var cors_api_url = 'https://' + cors_api_host + '/';
    //     var slice = [].slice;
    //     // var origin = window.location.protocol + '//' + window.location.host;
    //     var origin = '//web.whatsapp.com/?iframe_channel=is_anivia&output=embed';
    //     var open = XMLHttpRequest.prototype.open;
    //     XMLHttpRequest.prototype.open = function() {
    //         var args = slice.call(arguments);
    //         var targetOrigin = /^https?:\/\/([^\/]+)/i.exec(args[1]);
    //         if (targetOrigin && targetOrigin[0].toLowerCase() !== origin &&
    //             targetOrigin[1] !== cors_api_host) {
    //             args[1] = cors_api_url + args[1];
    //         }
    //         return open.apply(this, args);
    //     };
    // })();
</script>

</html>