<html>

<head>
    <p style="font-size: 20px; color: red">
        使用table标签方式将json导出xls文件
    </p>
    <button onclick="tableToExcel()">导出</button>
</head>

<body>
    <script src="./a.js"></script>
    <script src="./b.js"></script>
    <script>
        // 要导出的json数据
        const jsonData = [];
        console.error('a', a);
        console.error('b', b);

        const filteredData = b.filter(item1 => {
            return a.some(item2 => {
                return Number(item1.lncRNA_start_Y1) <= Number(item2.lncRNA_start_X1) && 
                    Number(item2.lncRNA_start_X1) <= Number(item1.lncRNA_end_Y2) && 
                    Number(item1.lncRNA_end_Y2) <= Number(item2.lncRNA_end_X2);
            });
        });

        // const cc = bb.filter(item1 => {
        //     return aa.some(item2 => {
        //         return item1.y1 <= item2.x1 && 
        //                 item2.x1 <= item1.y2 && 
        //                 item1.y2 <= item2.x2;
        //     });
        // });


        jsonData.push(...filteredData);

        console.error(jsonData);

        const tableToExcel = () => {
            // 列标题
            let str = "<tr><td>lncRNA_chr</td><td>lncRNA_start_Y1</td><td>lncRNA_end_Y2</td></tr>";
            // 循环遍历，每行加入tr标签，每个单元格加td标签
            for (let i = 0; i < jsonData.length; i++) {
                str += "<tr>";
                for (const key in jsonData[i]) {
                    // 增加\t为了不让表格显示科学计数法或者其他格式
                    str += `<td>${jsonData[i][key] + "\t"}</td>`;
                }
                str += "</tr>";
            }
            // Worksheet名
            const worksheet = "Sheet1";
            const uri = "data:application/vnd.ms-excel;base64,";

            // 下载的表格模板数据
            const template = `<html xmlns:o="urn:schemas-microsoft-com:office:office" 
                xmlns:x="urn:schemas-microsoft-com:office:excel" 
                xmlns="http://www.w3.org/TR/REC-html40">
                <head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>
                <x:Name>${worksheet}</x:Name>
                <x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet>
                </x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->
                </head><body><table>${str}</table></body></html>`;
            // 下载模板
            window.location.href = uri + base64(template);
        };

        // 输出base64编码
        const base64 = (s) => window.btoa(unescape(encodeURIComponent(s)));
    </script>
</body>

</html>